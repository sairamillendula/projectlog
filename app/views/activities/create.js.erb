<% if @activity.valid? %>
  $("form#new_activity").get(0).reset(); // Clear out the form
  $("#activity-fields").effect("highlight", {}, 1000);
  $("#activities").html($("<%= escape_javascript render(:partial => 'activities/activities') %>"));
  $('<%= escape_javascript render(:partial => 'fields.js') %>').insertBefore('#time-entries'); // Show the new activity form again.
  $("#row_for_activity_<%= @activity.id %>").effect("highlight", {}, 1000);
  $('.new_activity_link').show();
<% else %>
  $('<div id="activity-error"></div>')
		.html('<div class="alert">Please fix the following errors: <%= escape_javascript @activity.errors.full_messages.to_sentence %></div>')
		.dialog({
			autoOpen: true,
			buttons: { 'OK' : function(){ $(this).dialog("close"); } },
			modal: true,
			show: "fade",
			hide: "fade",
    });
<% end %>