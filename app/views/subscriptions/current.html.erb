<h1>Payment History</h1>
<% unless current_user.subscription_transactions.blank? %>
  <table>
  <% current_user.subscription_transactions.order('created_at DESC').each do |transaction| %>
    <tr>
      <td><%= transaction.created_at.strftime("%B %d, %Y") %></td>
      <td>Transaction #<%= transaction.code %></td>
      <td><%= number_to_currency(transaction.amount) %></td>
      <td><%= link_to "Printable Receipt (PDF)", receipt_subscription_payment_path(current_user.current_subscription, transaction.code) %></td>
    </tr>
  <% end %>
  </table>
<% end %>

<h2>Your current plan: <%= current_user.plan.name %></h2>
<% if current_user.current_subscription %>
  <% if current_user.current_subscription.cancelled? %>
    <h2>You've cancelled your subscription. You can continue to use the <%= current_user.current_subscription.plan.name %> plan until it expires on <%= current_user.current_subscription.modify_on.strftime("%B %d, %Y") %>.</h2>
    <p><%= link_to 'Reactivate', reactivate_subscriptions_path, :method => :post, :class => 'buttonorange' %></p>
  <% else %>
    <% if current_user.current_subscription.next_payment_due.to_date != current_user.current_subscription.created_at.to_date %>
      <h2>Next payment will be processed on <%= current_user.current_subscription.next_payment_due.strftime("%B %d, %Y") %>.</h2>
    <% end %>
    <p><%= link_to 'Edit Subscription & Payment Method', edit_subscription_path(current_user.current_subscription), :class => 'buttonorange' %></p>
  <% end %>
<% else %>
  <p><%= link_to 'Upgrade', new_subscription_path, :class => 'buttonorange' %></p>
<% end %>